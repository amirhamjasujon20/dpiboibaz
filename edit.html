<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü - DPI Boi Baz</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Arial', sans-serif; background: #f4f7f6; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; padding-bottom: 100px; }
        .container { width: 100%; max-width: 480px; }
        .section-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-bottom: 20px; position: relative; }
        
        h2 { color: #006747; font-size: 14px; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-top: 0; display: flex; justify-content: space-between; align-items: center; }
        
        .edit-toggle { color: #006747; cursor: pointer; font-size: 14px; transition: 0.3s; }
        .edit-toggle.active { color: #E03C31; }

        label { display: block; margin-top: 12px; font-weight: bold; font-size: 12px; color: #555; }
        
        input { 
            width: 100%; padding: 10px; margin-top: 5px; border: 1.5px solid #ddd; 
            border-radius: 8px; box-sizing: border-box; font-size: 13px; 
            transition: 0.3s; background: #eeeeee; color: #777; pointer-events: none;
        }

        /* ‡¶è‡¶°‡¶ø‡¶ü ‡¶Æ‡ßã‡¶° ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        input.editable { background: #ffffff; border-color: #006747; color: #333; pointer-events: auto; }
        
        /* ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ï ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
        .locked-phone { background: #eeeeee !important; color: #999 !important; pointer-events: none !important; }

        .btn-save { 
            background: #006747; 
            color: white; 
            border: none; 
            padding: 10px;
            border-radius: 8px; 
            cursor: pointer; 
            margin-top: 15px; 
            width: 100%; 
            display: none; 
            font-size: 14px;
            font-weight: bold;
        }
        
        .book-item { border-bottom: 1px solid #eee; padding: 15px 0; }
        .delete-btn { color: #E03C31; cursor: pointer; font-size: 11px; margin-top: 10px; display: inline-block; font-weight: bold; }

        /* ‡¶¨‡¶ü‡¶Æ ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® */
        .bottom-nav { position: fixed; bottom: 20px; width: 90%; max-width: 480px; display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        
        .home-btn { width: 50px; height: 50px; background: #006747; color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; text-decoration: none; font-size: 18px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        
        .logout-btn { background: #E03C31; color: white; padding: 12px 25px; border-radius: 10px; text-decoration: none; font-weight: bold; font-size: 14px; box-shadow: 0 4px 10px rgba(224, 60, 49, 0.3); display: flex; align-items: center; gap: 8px; }

        #statusModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); justify-content: center; align-items: center; z-index: 1000; }
        .modal-box { background: white; padding: 25px; border-radius: 15px; text-align: center; width: 80%; max-width: 300px; animation: zoom 0.3s; }
        @keyframes zoom { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div class="container">
        <div class="section-card">
            <h2>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ <i class="fa-solid fa-user-pen edit-toggle" onclick="toggleProfileEdit(this)"></i></h2>
            <label>‡¶®‡¶æ‡¶Æ</label>
            <input type="text" id="userName" class="profile-input">
            
            <label>‡¶´‡ßã‡¶® ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ (‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶®‡¶Ø‡¶º)</label>
            <input type="text" id="userPhoneDisplay" class="locked-phone">
            
            <label>‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
            <input type="text" id="userPass" class="profile-input">
            
            <button id="saveProfileBtn" class="btn-save" onclick="updateProfile()">‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>

        <div class="section-card">
            <h2>‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶á‡¶∏‡¶Æ‡ßÇ‡¶π <i class="fa-solid fa-pen-to-square edit-toggle" onclick="toggleBooksEdit(this)"></i></h2>
            <div id="booksList">‡¶¨‡¶á ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
        </div>

        <button onclick="deleteAccount()" style="color:#999; background:none; border:none; cursor:pointer; font-size:12px; margin: 0 auto; display: block;">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</button>
    </div>

    <div class="bottom-nav">
        <a href="index.html" class="home-btn" title="‡¶π‡ßã‡¶Æ‡ßá ‡¶Ø‡¶æ‡¶®">
            <i class="fa-solid fa-arrow-left"></i>
        </a>
        <a href="#" class="logout-btn" onclick="logoutUser()">
            <i class="fa-solid fa-right-from-bracket"></i> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü
        </a>
    </div>

    <div id="statusModal">
        <div class="modal-box">
            <div id="modalIcon" style="font-size: 40px; margin-bottom: 10px;"></div>
            <p id="modalText" style="font-weight: bold; color: #333;"></p>
            <button onclick="location.reload()" style="background:#006747; color:white; border:none; padding:10px 25px; border-radius:8px; cursor:pointer; margin-top:15px;">‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc, collection, query, where, getDocs, deleteDoc, writeBatch } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® (Boi Baz v2)
        const firebaseConfig = {
           apiKey: "AIzaSyDbtD45rBSZN5RUXCHijFiabZ0uKPYeya0",
            authDomain: "boi-baz.firebaseapp.com",
            projectId: "boi-baz",
            storageBucket: "boi-baz.firebasestorage.app",
            messagingSenderId: "590447599233",
            appId: "1:590447599233:web:c969d315d5d4f2b3f87780"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const userId = localStorage.getItem('userId');
        const currentPhone = localStorage.getItem('userPhone');

        if (!userId) window.location.href = "login.html";

        window.toggleProfileEdit = (icon) => {
            const inputs = document.querySelectorAll('.profile-input');
            const saveBtn = document.getElementById('saveProfileBtn');
            icon.classList.toggle('active');
            inputs.forEach(input => input.classList.toggle('editable'));
            saveBtn.style.display = icon.classList.contains('active') ? 'block' : 'none';
        };

        window.toggleBooksEdit = (icon) => {
            const inputs = document.querySelectorAll('.book-input');
            const saveBtns = document.querySelectorAll('.btn-book-save');
            icon.classList.toggle('active');
            inputs.forEach(input => input.classList.toggle('editable'));
            saveBtns.forEach(btn => btn.style.display = icon.classList.contains('active') ? 'block' : 'none');
        };

        async function loadData() {
            const userRef = doc(db, "users", userId);
            const userSnap = await getDoc(userRef);
            if (userSnap.exists()) {
                document.getElementById('userName').value = userSnap.data().name;
                document.getElementById('userPass').value = userSnap.data().pass;
                document.getElementById('userPhoneDisplay').value = userSnap.data().phone;
            }

            const q = query(collection(db, "books"), where("phone", "==", currentPhone));
            const querySnapshot = await getDocs(q);
            const list = document.getElementById('booksList');
            list.innerHTML = "";

            if (querySnapshot.empty) {
                list.innerHTML = "<p style='color:#999; font-size:12px;'>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶á ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶®‡ßá‡¶á‡•§</p>";
                return;
            }

            querySnapshot.forEach((doc) => {
                const data = doc.data();
                list.innerHTML += `
                    <div class="book-item">
                        <label>‡¶¨‡¶á‡¶Ø‡¶º‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                        <input type="text" id="bn-${doc.id}" class="book-input" value="${data.bookName}">
                        <label>‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡¶®‡ßÄ</label>
                        <input type="text" id="bp-${doc.id}" class="book-input" value="${data.publisher}">
                        <button class="btn-save btn-book-save" onclick="updateBook('${doc.id}')">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <span class="delete-btn" onclick="deleteBook('${doc.id}')"><i class="fa-solid fa-trash-can"></i> ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡ßÅ‡¶®</span>
                    </div>
                `;
            });
        }

        window.updateProfile = async () => {
            const name = document.getElementById('userName').value;
            const pass = document.getElementById('userPass').value;
            await updateDoc(doc(db, "users", userId), { name, pass });
            localStorage.setItem('userName', name);
            showModal("‚úÖ", "‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
        };

        window.updateBook = async (id) => {
            const bName = document.getElementById(`bn-${id}`).value;
            const bPub = document.getElementById(`bp-${id}`).value;
            await updateDoc(doc(db, "books", id), { bookName: bName, publisher: bPub });
            showModal("‚úÖ", "‡¶¨‡¶á‡¶Ø‡¶º‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
        };

        window.deleteBook = async (id) => {
            if(confirm("‡¶¨‡¶á‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?")) {
                await deleteDoc(doc(db, "books", id));
                showModal("üóëÔ∏è", "‡¶¨‡¶á‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
            }
        };

        window.deleteAccount = async () => {
            if(confirm("‡¶∏‡¶æ‡¶¨‡¶ß‡¶æ‡¶®! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ì ‡¶∏‡¶ï‡¶≤ ‡¶¨‡¶á ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§")) {
                const q = query(collection(db, "books"), where("phone", "==", currentPhone));
                const snap = await getDocs(q);
                const batch = writeBatch(db);
                snap.forEach(d => batch.delete(d.ref));
                await batch.commit();
                await deleteDoc(doc(db, "users", userId));
                localStorage.clear();
                window.location.href = "index.html";
            }
        };

        window.logoutUser = () => {
            if(confirm("‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
                localStorage.clear();
                window.location.href = "index.html";
            }
        };

        function showModal(icon, msg) {
            document.getElementById('modalIcon').innerText = icon;
            document.getElementById('modalText').innerText = msg;
            document.getElementById('statusModal').style.display = 'flex';
        }

        loadData();
    </script>
</body>

</html>
