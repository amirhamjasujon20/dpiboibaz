<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶¨‡¶á ‡¶ï‡¶ø‡¶®‡ßÅ‡¶® - DPI Boi Baz</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="manifest" href="manifest.json">
    <style>
        body { font-family: 'Arial', sans-serif; background: radial-gradient(circle, rgba(224, 60, 49, 0.1) 20%, rgba(0, 103, 71, 0.1) 100%); min-height: 100vh; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .search-card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 500px; text-align: center; margin-bottom: 30px; }
        h2 { color: #006747; margin-bottom: 20px; }
        select { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ddd; border-radius: 12px; font-size: 16px; outline: none; transition: 0.3s; background: #f9f9f9; }
        select:focus { border-color: #006747; background: white; }
        .btn-search { width: 100%; background: #006747; color: white; border: none; padding: 12px; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 15px; transition: 0.3s; }
        .btn-search:hover { background: #004d35; transform: translateY(-2px); }
        .results-area { width: 100%; max-width: 600px; }
        .seller-group-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border-left: 6px solid #006747; }
        .seller-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px; }
        .seller-name { font-weight: bold; color: #333; font-size: 16px; }
        .contact-btn { background: #28a745; color: white; text-decoration: none; padding: 6px 15px; border-radius: 20px; font-size: 14px; font-weight: bold; }
        .book-item { display: flex; align-items: center; background: #fdfdfd; padding: 10px; border-radius: 10px; margin-top: 8px; border: 1px dashed #ccc; }
        .book-icon { font-size: 20px; margin-right: 12px; }
        .book-info h4 { margin: 0; font-size: 15px; color: #006747; }
        .book-info p { margin: 2px 0 0; font-size: 13px; color: #666; }
        .home-btn { position: fixed; bottom: 30px; left: 30px; width: 50px; height: 50px; background: #006747; color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; text-decoration: none; font-size: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div class="search-card">
    <h2>‡¶¨‡¶á ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</h2>
    
    <select id="semester">
        <option value="" disabled selected>‡¶∏‡ßá‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
        <option value="‡ßß‡¶Æ">‡ßß‡¶Æ ‡¶∏‡ßá‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</option>
        <option value="‡ß®‡¶Ø‡¶º">‡ß®‡¶Ø‡¶º ‡¶∏‡ßá‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</option>
        <option value="‡ß©‡¶Ø‡¶º">‡ß©‡¶Ø‡¶º ‡¶∏‡ßá‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</option>
        <option value="‡ß™‡¶∞‡ßç‡¶•">‡ß™‡¶∞‡ßç‡¶• ‡¶∏‡ßá‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</option>
        <option value="‡ß´‡¶Æ">‡ß´‡¶Æ ‡¶∏‡ßá‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</option>
        <option value="‡ß¨‡¶∑‡ßç‡¶†">‡ß¨‡¶∑‡ßç‡¶† ‡¶∏‡ßá‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</option>
        <option value="‡ß≠‡¶Æ">‡ß≠‡¶Æ ‡¶∏‡ßá‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</option>
        <option value="‡ßÆ‡¶Æ">‡ßÆ‡¶Æ ‡¶∏‡ßá‡¶Æ‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞</option>
    </select>

    <select id="technology">
        <option value="">‡¶ü‡ßá‡¶ï‡¶®‡ßã‡¶≤‡¶ú‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
        <option value="Architecture">Architecture</option>
        <option value="Automobile">Automobile</option>
        <option value="Chemical">Chemical</option>
        <option value="Civil">Civil</option>
        <option value="Civil (Wood)">Civil (Wood)</option>
        <option value="Computer">Computer</option>
        <option value="Electrical">Electrical</option>
        <option value="Electronics">Electronics</option>
        <option value="Environmental">Environmental</option>
        <option value="Food">Food</option>
        <option value="Mechanical">Mechanical</option>
        <option value="Power">Power</option>
        <option value="Refrigeration and Air Conditioning">RAC</option>
    </select>

    <button class="btn-search" onclick="searchBooks()">‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<div class="results-area" id="results"></div>

<a href="index.html" class="home-btn">üè†</a>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
            apiKey: "AIzaSyDbtD45rBSZN5RUXCHijFiabZ0uKPYeya0",
            authDomain: "boi-baz.firebaseapp.com",
            projectId: "boi-baz",
            storageBucket: "boi-baz.firebasestorage.app",
            messagingSenderId: "590447599233",
            appId: "1:590447599233:web:c969d315d5d4f2b3f87780"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.searchBooks = async function() {
        const tech = document.getElementById('technology').value;
        const sem = document.getElementById('semester').value;
        const resultArea = document.getElementById('results');

        if(!tech || !sem) { alert("‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ò‡¶∞ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§"); return; }

        resultArea.innerHTML = "<p style='text-align:center;'>‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>";

        try {
            // ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá technology ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶¶‡¶ø‡ßü‡ßá‡¶ì ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶õ‡¶ø
            const q = query(
                collection(db, "books"), 
                where("technology", "==", tech), 
                where("semester", "==", sem)
            );
            
            let querySnapshot = await getDocs(q);

            // ‡¶Ø‡¶¶‡¶ø technology ‡¶´‡¶ø‡¶≤‡ßç‡¶°‡ßá ‡¶®‡¶æ ‡¶™‡¶æ‡ßü, ‡¶§‡¶¨‡ßá department ‡¶´‡¶ø‡¶≤‡ßç‡¶°‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡¶¨‡ßá
            if (querySnapshot.empty) {
                const qAlt = query(
                    collection(db, "books"), 
                    where("department", "==", tech), 
                    where("semester", "==", sem)
                );
                querySnapshot = await getDocs(qAlt);
            }

            resultArea.innerHTML = "";

            if (querySnapshot.empty) {
                resultArea.innerHTML = "<p style='text-align:center; color:#555;'>‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶á ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>";
                return;
            }

            const groups = {};
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const phone = data.phone;
                if (!groups[phone]) {
                    groups[phone] = { sellerName: data.sellerName, books: [] };
                }
                groups[phone].books.push(data);
            });

            for (const phone in groups) {
                const group = groups[phone];
                let bookItemsHtml = "";
                group.books.forEach(book => {
                    bookItemsHtml += `<div class="book-item"><div class="book-icon">üìö</div><div class="book-info"><h4>${book.bookName}</h4><p>‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂‡¶®‡ßÄ: ${book.publisher}</p></div></div>`;
                });
                resultArea.innerHTML += `<div class="seller-group-card"><div class="seller-header"><span class="seller-name">üë§ ${group.sellerName}</span><a href="tel:${phone}" class="contact-btn">‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</a></div><div class="books-list">${bookItemsHtml}</div></div>`;
            }
        } catch (error) {
            console.error(error);
            resultArea.innerHTML = "<p style='text-align:center; color:red;'>‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§</p>";
        }
    }
</script>
</body>

</html>
